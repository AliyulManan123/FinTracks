<%- include('../layouts/main', { body: `
  <h1 class="text-2xl font-semibold mb-4">Settings</h1>

  <div class="grid md:grid-cols-2 gap-4">
    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-semibold mb-2">Profile</h2>
      <form action="/settings/profile?_csrf=${csrfToken}" method="post" class="space-y-3">
        <div>
          <label class="block text-sm">Name</label>
          <input name="name" value="${user.name}" class="w-full border p-2 rounded" />
        </div>
        <div>
          <label class="block text-sm">Avatar URL</label>
          <input name="avatarUrl" value="${user.avatarUrl || ''}" class="w-full border p-2 rounded" />
        </div>
        <button class="px-3 py-2 bg-gray-900 text-white rounded">Save</button>
      </form>
    </div>

    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-lg font-semibold mb-2">Security</h2>
      <form action="/settings/security?_csrf=${csrfToken}" method="post" class="space-y-3">
        <div>
          <label class="block text-sm">Current Password</label>
          <input name="currentPassword" type="password" class="w-full border p-2 rounded" />
        </div>
        <div>
          <label class="block text-sm">New Password</label>
          <input name="newPassword" type="password" class="w-full border p-2 rounded" />
        </div>
        <button class="px-3 py-2 bg-gray-900 text-white rounded">Update Password</button>
      </form>
    </div>
  </div>

  <div class="bg-white p-4 rounded shadow mt-4">
    <h2 class="text-lg font-semibold mb-2">Categories</h2>
    <form action="/settings/categories?_csrf=${csrfToken}" method="post" class="flex gap-2 mb-3">
      <input type="hidden" name="action" value="create" />
      <input name="name" placeholder="New category name" class="border p-2 rounded" />
      <button class="px-3 py-2 border rounded">Add</button>
    </form>

    <div class="grid md:grid-cols-2 gap-4">
      ${categories.map(c => `
        <div class="border rounded p-3">
          <div class="flex justify-between items-center">
            <div class="font-medium">${c.name}</div>
            <form action="/settings/categories?_csrf=${csrfToken}" method="post">
              <input type="hidden" name="action" value="delete" />
              <input type="hidden" name="categoryId" value="${c.id}" />
              <button class="text-red-600 underline">Delete</button>
            </form>
          </div>
          <ul class="ml-4 mt-2 list-disc">
            ${(c.subCategories || []).map(s => `<li>${s.name}</li>`).join('')}
          </ul>
          <form action="/settings/categories?_csrf=${csrfToken}" method="post" class="flex gap-2 mt-2">
            <input type="hidden" name="action" value="createSub" />
            <input type="hidden" name="categoryId" value="${c.id}" />
            <input name="name" placeholder="Add subcategory" class="border p-2 rounded flex-1" />
            <button class="px-3 py-2 border rounded">Add</button>
          </form>
        </div>
      `).join('')}
    </div>
  </div>
` }) %>
